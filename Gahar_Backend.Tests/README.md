# Gahar Backend - Unit Tests Documentation

## ?? ???? ????

??? ??????? ????? ??? ???????? ????? ????? ?????? ?????? ??????? ?? Gahar Backend.

## ?? ????? ??????????

### 1. **Entity Tests** (???????? ????????)
- `UserTests.cs` - ???????? ???? ????????
- `RoleAndPermissionTests.cs` - ???????? ??????? ??????????

### 2. **Service Tests** (???????? ???????)
- `JwtServiceTests.cs` - ???????? ???? JWT
- `AuthServiceTests.cs` - ???????? ???? ????????
- `AuditLogServiceTests.cs` - ???????? ???? ??? ???????
- `TranslationServiceTests.cs` - ???????? ???? ???????

### 3. **Repository Tests** (???????? ??????????)
- `GenericRepositoryTests.cs` - ???????? ???????? ?????
- `UserRepositoryTests.cs` - ???????? ?????? ??????????

### 4. **Middleware Tests** (???????? ???????)
- `ExceptionHandlingMiddlewareTests.cs` - ???????? ?????? ???????????

### 5. **Filter Tests** (???????? ???????)
- `PermissionAttributeTests.cs` - ???????? ???? ?????????
- `AuditLogActionFilterTests.cs` - ???????? ???? ??? ???????

### 6. **DTO Tests** (???????? ????? ??? ????????)
- `AuthDtosTests.cs` - ???????? DTOs ?????? ?????????

## ?? ????? ??????????

### ????? ???? ??????????
```bash
dotnet test
```

### ????? ???????? ?????
```bash
dotnet test --filter "FullyQualifiedName~UserTests"
```

### ????? ?? ????? ???????
```bash
dotnet test --collect:"XPlat Code Coverage"
```

### ????? ?? ??? ????
```bash
dotnet test --logger "console;verbosity=detailed"
```

## ?? ???????? ???????

| ?????? | ??? ?????????? | ??????? ???????? |
|--------|----------------|-------------------|
| Entities | 15+ | 90%+ |
| Services | 40+ | 85%+ |
| Repositories | 25+ | 90%+ |
| Middleware | 10+ | 80%+ |
| Filters | 10+ | 85%+ |
| DTOs | 15+ | 95%+ |

**?????? ??????????:** 115+ ??????

## ?? ??????? ?????????

- **xUnit** - ???? ???????? ???????
- **Moq** - ????? ????? ???????? ??????? (Mocking)
- **FluentAssertions** - ????? ????????? ???????
- **Entity Framework Core InMemory** - ????? ?????? ?? ??????? ??????????

## ?? ????? ??? ??????????

### ???? 1: ?????? ????? ?????? ??????
```csharp
[Fact]
public async Task LoginAsync_WithValidCredentials_ShouldReturnAuthResponse()
{
 // Arrange
    var loginDto = new LoginDto { Email = "test@example.com", Password = "password123" };
    // ... setup mocks

    // Act
    var result = await _authService.LoginAsync(loginDto);

    // Assert
  result.Should().NotBeNull();
    result.AccessToken.Should().NotBeNullOrEmpty();
}
```

### ???? 2: ?????? Soft Delete
```csharp
[Fact]
public async Task DeleteAsync_ShouldSoftDeleteUser()
{
    // Act
    var result = await _userRepository.DeleteAsync(1);

    // Assert
    result.Should().BeTrue();
    var user = await _context.Users.IgnoreQueryFilters().FirstOrDefaultAsync(u => u.Id == 1);
  user!.IsDeleted.Should().BeTrue();
}
```

## ? ?????? ???????? ?????

1. **AAA Pattern** - Arrange, Act, Assert
2. **????? ?????** - `MethodName_Scenario_ExpectedResult`
3. **?????? ???? ??? ???????**
4. **????????? ??????????** - ?? ?????? ????? ?? ?????
5. **??????? In-Memory Database** - ????????? ????? ????????

## ?? ??????? ???????

### ?????: ?????????? ???? ????????
**????:** ???? ?? ??????? `Guid.NewGuid()` ?? ????? ????? ???????? ?? ???????

### ?????: ???????? ??????? ????
**????:** ?????? `BeCloseTo()` ????? ?? `Be()` ????????

```csharp
entity.CreatedAt.Should().BeCloseTo(DateTime.UtcNow, TimeSpan.FromSeconds(1));
```

## ?? ????????? ??????????

- [ ] ????? ???????? Integration Tests
- [ ] ????? ???????? Performance Tests
- [ ] ????? ????? ????? ???? ??? 95%+
- [ ] ????? ???????? End-to-End
- [ ] ????? CI/CD Pipeline ??????????

## ?? ?????

?????? ?? ????????? ?? ??????? ?? ?????? ???? ??????? ?? ???? ???????.

---

**??? ?????:** 2025-01-11
**??????:** ? ???? ?????????
